<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{$goodsinfo.goods_name}</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/index.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/base.css"/>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/static/css/goods/goodsinfo.css"/>
    <script src="__PUBLIC__/static/js/jquery/jquery.min.js" type="text/javascript"></script>
    <!--<script src="__PUBLIC__/static/js/jquery/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>-->

</head>
<body>
<include file="public/indexhead"/>
<div style="background-color: #f5f5f5">
            <div class="buyticket">

                    <div class="bread-wrapper" style="font-size: 16px">
                        <foreach name="navigate" key="k1" item="nav">
                        <span class="project-name"><a href="//www.acgn.com">{$nav}</a></span>
                        <span class="symbol">&nbsp &gt; &nbsp</span>
                        </foreach>
                        <span class="project-name" style="color: #999999;max-width: 8em;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;">{$Think.session.goodsname}</span>
                    </div>



                <foreach name="goods" key="k" item="v">
                <div class="whole-detail-info-wrapper">
                    <div class="detail-img-icon no_pic" style="background-image: url('../../../..{$v.original_img}')">
                    </div>
                   <!--<form id="buy_goods_form" name="buy_goods_form" method="post" action="{:url('Index/Goods/buycar')}">-->
                   <form id="buy_goods_form" name="buy_goods_form" method="post" action="">
                       <input type="text" hidden  name="item_id" id="item_id" value="{$Request.param.item_id}"/><!-- 商品规格id -->
                       <input type="text" hidden name="store_count" value="{$goodsinfo.goods_inventory}"/><!-- 活动库存 -->
                       <input type="text" hidden name="goods_id" id="goods_id" value="{$goodsinfo.id}"><!-- 商品id -->
                       <input type="text" hidden name="goods_price" value="{$goodsinfo.goods_price}"><!-- 商品价格 -->


                       <div class="detail-info-wrapper">
                        <div class="product-info-name" id="goods_name">{$v.goods_name}</div>
                        <div class="product-info-time-wrapper">
                            <div class="product-info-time-title" >商 城 价：</div>
                            <div class="product-info-time" style="font-size: 22px;color: #e23435" data-goodsprice="{$v.goods_price}" id="goods_price" >￥{$v.goods_price}</div>
                        </div>
                        <div class="vuene-wrapper">
                            <div class="title">市 场 价：</div>
                            <div class="vuene-info-content">
                                <div class="title" style="text-decoration:line-through;"> ￥300</div>
                                <div class="address-name"></div>

                            </div>
                        </div>
                        <div class="login-show-wrapper">
                            <foreach name="spec" key="k2" item="v2">
                            <div class="spec-item">
                                 <ul class="clearfix mr4">
                                    <li class="title">{$k2}：</li>

                                         <li class="tickets">
                                             <foreach name="$v2" key="k3" item="v3">
                                                 <input type="radio" hidden id="goods_spec_{$v3.item_id}" name="goods_spec[{$k2}]" value="{$v3.item_id}"/>
                                                 <a id="goods_spec_a_{$v3.item_id}" class="selectable-option spec_item ">{$v3.item}</a>
                                             </foreach>
                                         </li>
                                </ul>
                            </div>
                            </foreach>


                            <ul class="clearfix">
                                <li class="title">数量：</li>
                                <li class="num-content">
                                    <div class="ticket-count">

                                        <a class="count-reduce" href="javascript:void(0);" onclick="altergoodsnum(-1)">-</a>
                                        <input class="count-number" id="number" type="text" name="goods_num" value="1"
                                               onblur="altergoodsnum(0)" max=""/>
                                        <a class="count-plus active" href="javascript:void(0);" onclick="altergoodsnum(1)">+</a>

                                    </div>
                                    <div style="float: left;margin-left: 20px;margin-top: 10px">库存：<span id="spec_store_count" data-storecount="{$goodsinfo.goods_inventory}">{$goodsinfo.goods_inventory}</span></div>


                                </li>
                            </ul> <!---->
                            <div class="product-buy-wrapper">
                                <div class="enable product-buy buy_button" id="buy_button">立即购买</div>
                                <div class="want-wrapper">
                                    <div class="enable product-buy buy_car ">
                                        <!--<input type="submit" value="加入购物车">-->
                                      加入购物车
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                   </form>
                </div>
                </foreach>
            </div>

        <div class="tabs-wrapper ticket-system-container">
            <div class="tabs">
                <div class="tabs-item active">参展嘉宾</div>
                <div class="tabs-item">活动详情</div>
                <div class="tabs-item">讨论</div>
            </div>
        </div>

        <div class="detail-content-wrapper">
            <div class="detail-content">
                <div class="activity-info-wrapper ticket-system-container">
                    <div class="activity-info scroll-wrapper">
                        <div class="activity-info-header">
                            <div class="icon icon-activity"></div>
                            <div class="guest-title">活动详情</div>
                        </div>
                        <div class="activity-info-content">
                            <p>
                                <span style="color: rgb(34, 34, 34);">活动时间：</span>
                                2018年12月30日-2019年1月1日&nbsp;
                                <span style="color: rgb(34, 34, 34);">09:00-17:00</span>
                            </p>
                            <p>
                                <span style="color: rgb(34, 34, 34);">活动地点：</span>
                                广州保利世贸博览馆5、6号馆（地铁琶洲站PWTC出口）
                            </p>
                            <p>儿童入场提示：1.2米以下儿童免门票入场，需大人陪同&nbsp;</p>
                            <p>票品及入场：本活动为电子票，凭购票二维码到活动现场扫码兑换纸票入场（订单或订单截图无效）</p>
                            <p>入场次数：单场票（ 单日单场次1次入场有效）</p>
                            <p><br></p>
                            <p>
                                <img src="__PUBLIC__/static/images/index-goods/pigaqiu/1.jpg">
                                <img src="__PUBLIC__/static/images/index-goods/pigaqiu/2.jpg">
                                <img src="__PUBLIC__/static/images/index-goods/pigaqiu/3.jpg">
                                <img src="__PUBLIC__/static/images/index-goods/pigaqiu/4.jpg">
                                <img src="__PUBLIC__/static/images/index-goods/pigaqiu/5.jpg">
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="recommend-wrapper">
                <div class="ticket-tips-wrapper">
                    <div class="ticket-tips">
                        <div class="ticket-tips-header">
                            <span></span>购票须知
                        </div>
                        <div class="ticket-tips-content">
                            <p>1、bilibili会员购在线售票为电子票或纸质票。</p>
                            <p>2、如您购买的是电子票，入场时请在bilibili APP中【订单中心】
                                打开电子票检票入场（部分活动需兑换实体票入场）；电子票不得转售，
                                请在正规途径购买；电子票截图无法入场。</p>
                            <p>3、如您购买的是纸质票，需在购票时填写准确配送信息，纸质票将在活动开始之前寄出，
                                邮费由用户承担；因纸质票的特殊性，遗失不补且无法挂失，请您保管好购买到的票品。
                            </p>
                            <p>4、部分活动不提供现场售票服务，请您提前购买。</p>
                            <p>5、因演出/赛事/展会等票品具有稀缺性和时效性的特点，一旦退货将会影响二次销售，
                                请您理解并认可，本网站提供的此类票品服务不适用7天无理由退货政策。
                            </p>
                            <p>6、为保障您的人身安全，主办方在人流高峰可能会采取临时现场限流措施，
                                如对您的正常观展产生影响，敬请谅解。
                            </p>
                            <p>7、若有其他问题请联系客服：客服入口在移动端APP “我的” 个人中心，点击“我的客服”，
                                选择“在线客服”，即可咨询。
                            </p>
                        </div>
                    </div>
                    <div class="rec-list-wrapper">
                        <div class="rec-list">
                            <div class="rec-item">
                                <!--<div class="rec-item-banner" style="background-image: url(&quot;//i0.hdslb.com/bfs/openplatform/201810/imU8yNLgeSdQ.jpeg&quot;);">-->
                                </div>
                                <div class="rec-item-name">上海·COMICUP23 魔都同人祭</div>
                                <div class="rec-item-time">2018.12.15 - 12.16</div>
                                <div class="rec-item-vuene">上海新国际博览中心</div>
                            </div>
                            <!--<div class="rec-item"><div class="rec-item-banner" style="background-image: url(&quot;//i1.hdslb.com/bfs/openplatform/201811/imHMuydub29LI.jpeg&quot;);">-->
                            </div> <div class="rec-item-name">广州·萤火虫动漫游戏嘉年华</div>
                                <div class="rec-item-time">2018.12.30 - 2019.01.01</div>
                                <div class="rec-item-vuene">广州保利世贸中心博览馆</div>
                            </div>
                            <div class="rec-item">
                                <!--<div class="rec-item-banner" style="background-image: url(&quot;//i0.hdslb.com/bfs/openplatform/201811/im5X4IMakAsdo.jpeg&quot;);"></div>-->
                                <div class="rec-item-name">核聚变Tour2018厦门站</div>
                                <div class="rec-item-time">2018.12.15 - 12.16</div>
                                <div class="rec-item-vuene">厦门国际会展中心</div>
                            </div><div class="rec-item">
                            <!--<div class="rec-item-banner" style="background-image: url(&quot;//i0.hdslb.com/bfs/openplatform/201811/im25QXDjOcho.png&quot;);"></div>-->
                            <div class="rec-item-name">成都·G-zone动漫游戏嘉年华x百花缭乱·梅赏祭</div>
                            <div class="rec-item-time">2018.12.22 - 12.23</div>
                            <div class="rec-item-vuene">成都东郊记忆</div>
                        </div><div class="rec-item">
                            <!--<div class="rec-item-banner" style="background-image: url(&quot;//i0.hdslb.com/bfs/openplatform/201811/im3z4j3bvlqQ.jpeg&quot;);"></div>-->
                            <div class="rec-item-name">上海·劇場版「Fate/stay night[Heaven's Feel]」 × animate cafe</div>
                            <div class="rec-item-time">2018.11.15 - 12.16</div>
                            <div class="rec-item-vuene">animate cafe 上海店</div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

</div>

<include file="public/footer"/>
</body>
<script>
    //购买数量加减
    function altergoodsnum(n) {
        var num = parseInt($('#number').val());
        var maxnum = parseInt($('#number').attr('max'));
        // var store =   $('input[name="store_count"]').val();
        if (maxnum > 200) {
            maxnum = 200;
        }
        num += n;
        num <= 0 ? num = 1 : num;
        if (num >= maxnum) {
            $(this).addClass('no-mins');
            num = maxnum;
        }
        $('#store_count').text(maxnum - num); //更新库存数量
        $('#number').val(num);

    }
    var spec_goods_price = {$spec_goods_price |default= 'null'};//规格库存价格
    // console.log(spec_goods_price);

    //默认让每种规格第一个选中
    function initFirstSpec() {
        $('.spec-item').each(function (i, o) {
            var firstSpecRadio = $(this).find("input[type='radio']").eq(0);
            firstSpecRadio.attr('checked', 'checked').prop('checked', true);
            firstSpecRadio.parent().find('a').eq(0).addClass('active');
        })
        initGoodsPrice();
    }
    initFirstSpec();

    //点击切换规格
    $(document).on('click','.spec_item',function () {
        $(this).addClass('active').siblings('a').removeClass('active');
        $(this).siblings('input').removeAttr('checked');
        $(this).prev('input').attr('checked','checked').prop('checked','checked');
        initGoodsPrice();



    });
    //sort排序用
    function sortNumber(a, b) {
        return a - b;
    }

    //初始化商品库存价格
    function initGoodsPrice() {
        var goods_id = $('input[name="goods_id"]').val();
        var goods_num = parseInt($('#number').val());

        if (!$.isEmptyObject(spec_goods_price)) {
            var goods_spec_arr = [];
            $("input[name^='goods_spec']").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    goods_spec_arr.push($(this).val());
                }
            });


            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
        }
        if (spec_goods_price[spec_key] != undefined){
            var item_id = spec_goods_price[spec_key]['item_id'];
            $('input[name=item_id]').val(item_id);
        }

        $.ajax({
            type: 'post',
            dataType: 'json',
            data: {goods_id: goods_id,goods_num: goods_num},
            url: "{:url('Index/Goods/changeprice')}",
            success: function (data) {
                if (data.status == 1) {
                    $('input[name="goods_price"]').attr(data.result.Specprice.goods_price);//商品库存
                    $('input[name="store_count"]').attr(data.result.Specprice.store_count);//商品库存
                }



            }
        });
        goods_activity_theme();
        setNormalGoodsPrice();
    }


    //商品价格库存显示
    function goods_activity_theme() {

        var buy_num = parseInt($('#number').val());//购买数
        var store = $('input[name="store_count"]').val();//实际库存数量
        // console.log(store);

        if (store <= 0) {
            $('#number').attr('min', store);
            $(this).attr('min', store);
        } else {
            $('#number').attr('max', store);

        }
        if (buy_num > store) {
            $('.buyNum').val(store);
        }

    }

    //普通商品库存和价格
    function setNormalGoodsPrice() {
        var goods_price, store_count;//商品价,商品库存

        // 如果有属性选择项
        if (!$.isEmptyObject(spec_goods_price)) {
            var goods_spec_arr = [];
            $("input[name^='goods_spec']").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    goods_spec_arr.push($(this).val());
                }
            });
            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
            goods_price = spec_goods_price[spec_key]['price']; // 规格的价格
            store_count = spec_goods_price[spec_key]['store_count']; // 规格的库存
            // market_price = spec_goods_price[spec_key]['market_price']; // 规格的市场价
            $("input[name='goods_price']").attr('value', goods_price);
            $("input[name='store_count']").attr('value', store_count);
            // $("input[name='market_price']").attr('value', market_price);
        } else {
            goods_price = $('#goods_price').attr('data-goodsprice');
            store_count = $('#spec_store_count').attr('data-storecount');
            $("input[name='goods_price']").attr('value', goods_price);
            $("input[name='store_count']").attr('value', store_count);
        }
        goods_price = $("input[name='goods_price']").attr('value');// 商品本店价
        store_count = $("input[name='store_count']").attr('value');// 商品库存
        // console.log(store_count);
        // $('#market_price_title').empty().html('市场价：');
        // $('#market_price').empty().html(market_price);
        $("#goods_price").html("<em>￥</em>" + goods_price); //变动价格显示
        $('#spec_store_count').html(store_count);
        $('.presale-time').hide();
        $('#number').attr('max', store_count);
        if (store_count <= 0) {
            $('#number').attr('value', store_count);
            $(this).attr('min', store_count);
            $('.buy_car').addClass("unable");
            $('.buy_button').addClass("unable");
        }else {
            $('#number').attr('value', 1);
            $('.buy_car').removeClass("unable");
            $('.buy_button').removeClass("unable");
        }
    }
    $(document).on('click','.buy_car',function () {
        buycar();
    });
    //加入购物车
    function buycar(){
        var goods_id = $(" input[ name='goods_id' ] ").val();
        var item_id = $("input[name='item_id']").val();
        // var goods_name = $('#goods_name').val();
        var goods_num = $("input[name='goods_num']").val();
        var store_count = $("input[name='store_count']").attr('value');// 商品库存
        if (store_count == 0){
            return false;
        } else {
            $.ajax({
                type: 'post',
                dataType: 'json',
                data: {goods_id: goods_id, item_id: item_id, goods_num: goods_num},
                url: "{:url('Index/Cart/addCart')}",
                success: function (data) {
                    if (data.status == 1) {
                        alert(data.msg);
                        // console.log(data.result);
                    }else {
                        alert(data.msg);
                    }

                }
            });
        }


    }



</script>
</html>